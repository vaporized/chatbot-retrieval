# Training with MEMN2N Model

The project has been modified to directly train with End-To-End memory networks on `tensorflow 1.2`.

## Training Schemes

### Model Mode
There are two modes described in the paper.
 - Adjacent: Use a sequence of embedding matrices for multiple hops. Slower with higher accuracy.
 - Layerwise: Use the same embedding matrix across all hops. Faster with lower accuracy.
 
### Data Preprocessing 
Given a batch of input tensors, there are three kinds (five in total) of preprocessing.
 - ### As provided: 
    * __Operation__: Use a vector with each word as a memory cell.
    * __Description__: A direct comparason with LSTM dual encoder. It does not capture the relationship between sentences in context.
    * __Output__: Tensor of `(batch_size, context_length)`.
 - ### Split (with overlapping): 
    * __Operation__: Take slices of given length of the input vector, and move forward `overlapping_size` elements each time.
 When overlapping is set to None, the default overlapping size is the sentence length.
 In this case it reduces to reshaping the original vector into a 2D matrix. 
    * __Description__: Split the context into *fake* sentences, it may capture the temporal relation within the context.
    * __Output__: Tensor of `(batch_size, memory_size, sentence_length)`.
 - ### Split at specific token: 
    * __Operation__: Find all positions of given token (`__eot__` or `__eou__` in this model). Take at most `memory_size`
  number of sentences, then pad or slice each sentence into `sentence_length`.
    * __Description__: This mode finds the real sentences in the context, which should be the intention of this model. Unfortunately ,
    due to the limitation of the existing implementation, processing with this scheme is very difficult and inefficient.
    * __Output__: Tensor of `(batch_size, memory_size, sentence_length)`.
    
## Parameters
All settings and hyper parameters are stored in `udc_hparams.py`.
 - __Model Mode__: `model_type`: `"adjacent"`, `"layer_wise"`
 - __Preprocessing__: `preprocessing_mode`: `None`, `"eou"`, `"eot"`, `"split"`, `"split_overlap"`
 - __Hyper Parameters__: Parameters for individual model is listed in the script, and some of them are generated by 
 `scripts/memn2n_parameters_estimate.py`.
 
 ## Files Changed:
 - New files: `models/memn2n.py`, `models/memn2n_2d_adjacent.py`, `models/memn2n_2d_layerwise.py`,
 `models/memn2n_3d_adjacent.py`, `models/memn2n_3d_layerwise.py`, `models/memn2n_preprocessing.py`,
 `scripts/memn2n_parameters_estimate.py`.
 - Other changes are minor fixes to make the project compatible with `tensorflow 1.2`.
 
 
